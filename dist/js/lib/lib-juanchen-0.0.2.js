define(["zepto"],function(t){"use strict";Function.prototype.bind||(Function.prototype.bind=function(t){var e=arguments,n=arguments[0],o=this;return function(){var t=Array.prototype.slice.call(e,1);return Array.prototype.push.apply(t,arguments),o.apply(n||null,t)}}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length>>>0,n=Number(arguments[1])||0;for((n=n<0?Math.ceil(n):Math.floor(n))<0&&(n+=e);n<e;n++)if(n in this&&this[n]===t)return n;return-1}),function(){for(var t=0,e=["webkit","moz"],n=0;n<e.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var n=(new Date).getTime(),o=Math.max(0,16-(n-t)),i=window.setTimeout(function(){e(n+o)},o);return t=n+o,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var e={tools:{},dores:{},dom:{},Factory:null};return e.CONST=function(){var e=document,n={$body:t("body"),$head:t("head"),$window:t(window),body:e.querySelector("body"),docWidth:e.documentElement.offsetWidth||e.body.offsetWidth,docHeight:e.documentElement.offsetHeight||e.body.offsetHeight,windowHeight:window.innerHeight,windowWidth:window.innerWidth};return{get:function(t){return n[t]}}}(),e.tools.addEvent=document.querySelector("body").addEventListener?function(t,e,n){t.addEventListener(e,n,!1)}:function(t,e,n){t.attachEvent("on"+e,n,!1)},e.tools.playImg={imgPlayTimer:{},play:function(e,n,o,i){var r=this,a=t(n).find("img"),s=0,c=a.length||a.size();r.imgPlayTimer[e]||(r.imgPlayTimer[e]=i?setInterval(function(){a.eq(s).show().siblings().hide(),++s>=c&&(s=0)},o):setInterval(function(){a.eq(s).show().siblings().hide(),++s>=c&&r.stopPlayImg(r.imgPlayTimer[e])},o))},stop:function(t){var e=this;clearInterval(e.imgPlayTimer[t]),e.imgPlayTimer[t]=null}},e.tools.getPosRelativeToScreen=function(t){return t.getBoundingClientRect()},e.tools.getPosRelativeToDocument=function(t){var e=document,n=t.getBoundingClientRect(),o=n.left,i=n.top;return o+=e.documentElement.scrollLeft||e.body.scrollLeft,i+=e.documentElement.scrollTop||e.body.scrollTop,{left:o,top:i}},e.tools.getStyle=function(t,e){return window.getComputedStyle?window.getComputedStyle(t,null)[e]:t.currentStyle[e]},e.tools.obj2str=function(t){return JSON.stringify(t)},e.tools.str2obj=function(t){return JSON.parse(t)},e.tools.reverseStr=function(t){return t.split("").reverse().join("")},e.tools.uploadImg=function(e,n,o){var i=new FormData;t.each(e[0].files,function(t,e){i.append("imageFile",e)}),t.ajax({url:n,type:"POST",data:i,cache:!1,contentType:!1,processData:!1,success:function(t){o(t)},error:function(){console.dir(arguments)}})},e.tools.isIE=function(){return!!("ActiveXObject"in window||window.ActiveXObject)||!1},e.tools.getConnectionType=function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{type:"unknow"},e=["unknown","ethernet","wifi","2g","3g","4g","none"];return"number"==typeof t.type?t.type_text=e[t.type]:t.type_text=t.type,"number"==typeof t.bandwidth&&(t.bandwidth>10?t.type="WI-FI":t.bandwidth>2?t.type="3G":t.bandwidth>0?t.type="2G":0==t.bandwidth?t.type="none":t.type="unknown"),t.type_text||t.type},e.tools.playVideo=function(t){!!t.paused&&t.play()},e.tools.pauseVideo=function(t){!t.paused&&t.pause()},e.tools.clearInterval=function(t){clearInterval(t),t=null},e.tools.DomScrollTo=function(t){var n=null,o="";"function"==typeof t.targetScrollTop&&(o=t.targetScrollTop.bind(null)),t.$clickEle.on("click",function(){var i;i=o?o(this):t.targetScrollTop;var r,a=t.$scrollEle.scrollTop(),s=a<i?1:-1,c=t.allTime/(Math.abs(i-a)/r);null===n&&(n=setInterval(function(){r=Math.abs(i-a)<15?1:15,s>0&&a>i||s<0&&a<i?e.tools.clearInterval(n):(a+=s*r,t.$scrollEle.scrollTop(a))},c))})},e.tools.whenWindowScroll=function(t){function n(e){return e<t.offsetTopCritical||e>=t.offsetTopMin&&e<=t.offsetTopMax}"calcDomRToScreen"==t.type?e.CONST.get("$window").on("scroll",function(){window.requestAnimationFrame(function(){n(e.tools.getPosRelativeToScreen(t.dom).top)?t.callback_in():t.callback_out()})}):e.CONST.get("$window").on("scroll",function(){window.requestAnimationFrame(function(){n(document.documentElement.scrollTop||document.body.scrollTop)?t.callback_in():t.callback_out()})})},e.dores.config=function(t){for(var e=0;e<t.length;e++)this[t[e]]()},e.dores.inputWithCheck=function(){t("body").on("blur",".c_input_withCheck input",function(){var e=t(this),n=e.parents(".c_input_withCheck").find(".check_result.error"),o=e.parents(".c_input_withCheck").find(".check_result.correct"),i=new RegExp(e.attr("data-reg")),r=e.val().trim(),a={};a.empty=e.attr("data-check-empty"),a.false=e.attr("data-check-false"),""==r?n.html(a.empty).addClass("active").siblings(".check_result").removeClass("active"):i.test(r)?o.addClass("active").siblings(".check_result").removeClass("active"):n.html(a.false).addClass("active").siblings(".check_result").removeClass("active")})},e.dores.tab=function(){var n="",o=null;e.CONST.get("$body").on("click",".c_tabBtn a",function(){var e=t(this),i=e.parent(".c_tabBtn").attr("data-tab");i!==n&&(n=i,o=t(e.parent(".c_tabBtn").attr("data-tab")));var r=o.children().eq(e.index());e.addClass("active").siblings(".active").removeClass("active"),r.addClass("active").siblings(".active").removeClass("active")})},e.dores.collapse=function(){var n=e.CONST.get("$body");n.on("click",".c_collapse_open",function(e){e.preventDefault();var n=t(this);t(n.attr("data-target")).addClass(n.attr("data-addclass"))}),n.on("click",".c_collapse_close",function(){var e=t(this);t(e.attr("data-close")).removeClass(e.attr("data-removeclass"))})},e.dores.floor=function(){},e.dom.H5_music=function(e){var n={musicSrc:"",bgPlay:"imgs/state1.png",bgStop:"imgs/state0.png",top:"1%",right:"2%"};e&&(n.top=e.top||n.top,n.right=e.right||n.right,n.musicSrc=e.musicSrc||n.musicSrc,n.bgStop=e.bgStop||n.bgStop,n.bgPlay=e.bgPlay||n.bgPlay);var o=[".c_audio{position:fixed;right:"+n.right+";top:"+n.top+";width:50px;height:50px;background-position:50% 50%;background-size:100% 100%;background-repeat:no-repeat;cursor:pointer;border-radius:50%}",".c_audio.stop{background-image:url("+n.bgStop+")}",".c_audio.play{background-image:url("+n.bgPlay+");animation:j_audio 3s infinite linear;-webkit-animation:j_audio 3s infinite linear}","@keyframes j_audio{0%{transform:rotate(0);-webkit-transform:rotate(0)}100%{transform:rotate(360deg);-webkit-transform:rotate(360deg)}}","@-webkit-keyframes j_audio{0%{transform:rotate(0);-webkit-transform:rotate(0)}100%{transform:rotate(360deg);-webkit-transform:rotate(360deg)}}"];t("head").append('<style class="juan-H5Music-style">'+o.join("")+"</style>"),t("body").prepend('<div class="c_audio stop"> <audio src="'+n.musicSrc+'"></audio></div>').on("click",".c_audio",function(e){var n=t(e.target),o=n.find("audio").get(0),i=n.css("transform");1==o.paused?(o.play(),n.addClass("play").removeClass("stop")):(o.pause(),n.addClass("stop").removeClass("play").css("transform",i))})},e.Factory=function(t,n){if(e.Factory.prototype[t])return new e.Factory.prototype[t](n);throw new Error("Factory.prototype中没有"+t)},e.Factory.prototype={Loading:function(){function e(t){var e={id:"#c_loading",needLoad:[],callback:function(){}};this.id=t.id||e.id,this.needLoad=t.needLoad||e.needLoad,this.callback=t.callback||e.callback}return e.prototype={init:function(){var e=this,n=0,o=e.needLoad.length,i=0,r=null;t(e.id).find(".progress").length>0&&(r=t(e.id).find(".progress"));for(var a=0;a<o;a++)i+=e.needLoad[a].weight;for(var s=0;s<o;s++){var c=document.createElement(e.needLoad[s].type);c.src=e.needLoad[s].src,function(o){c.onload=function(){n+=parseInt(e.needLoad[o].weight/i*100)+1,r.html(n+"%"),n>=100&&(r.html("100%"),setTimeout(function(){t(e.id).hide(),e.callback()},500))}}(s)}}},e}(),Alert:function(){function n(){this.alertNum="num"+ ++o,e.CONST.get("$body").prepend('<div class="c_alert '+this.alertNum+'" ><div class="con" ></div></div>'),this.$alert=t(".c_alert."+this.alertNum)}var o=0;return n.prototype={initCSS:function(){var n=e.CONST.get("$body"),o=[".c_alert{display: none;position:fixed;left:0;right:0;top:0;bottom:0;z-index:999;background-color: rgba(0,0,0,0.7);}",".c_alert.active{display: block;}",".c_alert .con{text-align: center;background-color: #fff;padding:3%;position: absolute;top:20%;left:50%;transform:translateX(-50%);-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%)}",".c_alert_btn {width:30%;font-size:13px;margin:0 10px;display: inline-block;background-color: #E40013;color:#fff;text-decoration:none;}"];return t("head").append("<style class='juan-alert-style'>"+o.join("")+"</style>"),n.on("click",".c_alert .c_alert_btn",function(e){t(e.target).parents(".c_alert").toggleClass("active").find(".con").html("")}),new Error("Alert._init自动执行一次，不需要手动调用")},alert:function(){function t(t){var e=!0;return-1==t.search(/(.jpg)|(.png)|(.gif)/i)&&(e=!1),e}var e,n;if("[object Object]"==Object.prototype.toString.call(arguments[0])){var o=arguments[0];n=o.content;var i,r;i=o.hasOwnProperty("btn_sure")?o.btn_sure:"确定",o.hasOwnProperty("callback_sure")&&this.$alert.one("click",".c_alert_btn.sure",o.callback_sure),r='<a href="javascript:void(0);"  class="c_alert_btn sure">'+i+"</a>",o.hasOwnProperty("btn_cancel")&&(r+='<a href="javascript:void(0);"  class="c_alert_btn cancel">'+o.btn_cancel+"</a>",o.hasOwnProperty("callback_cancel")&&this.$alert.one("click",".c_alert_btn.cancel",o.callback_cancel)),e=t(n)?'<p ><img src="'+n+'"/></p>':'<p style="padding:0 100px 50px 100px;">'+n+"</p>",e+=r}else{n=arguments[0];var a=arguments[1];!a&&(a="确定"),e=t(n)?'<p ><img src="'+n+'" /></p>':'<p style="padding:0 100px 50px 100px;">'+n+"</p>",e+='<a href="javascript:void(0);"  class="c_alert_btn sure">'+a+"</a>"}this.$alert.toggleClass("active").find(".con").append(e)}},n}(),Collide:function(){function e(e){function n(t,e){return parseInt(Math.random()*(e-t+1)+t)}var o=e.selector,i=e.moveObjArr;if(this.can=document.querySelector(o),this.ctx=this.can.getContext("2d"),this.stageWidth=parseInt(t(this.can).css("width")),this.stageHeight=parseInt(t(this.can).css("height")),this.stageHeight<1||this.stageWidth<1)throw new Error("canvas的高和宽太小");this.drawFnArr=[],this.imgDomArr=[],this.xs=[],this.dirs=[],this.ks=[],this.bs=[],this.ys=[],this.timer=null;for(var r=0;r<i.length;r++){var a={};this.xs[r]=n(20,200),this.bs[r]=n(10,100),this.ks[r]=Math.random(),this.dirs[r]=Math.random()<.5?1:-1;var s=i[r].type;if("img"==s){a.type="img";var c=i[r].src;void 0==this.imgDomArr[c]&&(this.imgDomArr[c]=document.createElement("img"),this.imgDomArr[c].src=c),function(t){a.fn=function(e,n,o,i,r,a){e.drawImage(n[t],o,i,r,a)}}(c)}else"rect"==s&&(a.type="rect",function(t,e){a.fn=function(n,o,i){n.fillRect(o,i,t,e)}}(i[r].option.width,i[r].option.height));this.drawFnArr.push(a)}}return e.prototype={init:function(){null===this.timer&&(this.timer=setInterval(function(){this.clear(),this.changeXY(),this.draw()}.bind(this),30))},clear:function(){this.ctx.clearRect(0,0,this.stageWidth,this.stageHeight)},changeXY:function(){function t(t){t.ks[n]*=-1,t.bs[n]=t.ys[n]-t.ks[n]*t.xs[n],t.ys[n]=t.ks[n]*t.xs[n]+t.bs[n]}function e(t,e){t.dirs[n]=e}for(var n=0;n<this.xs.length;n++)this.xs[n]+=(n+1)*this.dirs[n],this.ys[n]=this.ks[n]*this.xs[n]+this.bs[n],(this.ys[n]<=2||this.ys[n]>=this.stageHeight-32)&&t(this),this.xs[n]>=this.stageWidth-30&&(e(this,-1),t(this)),this.xs[n]<=0&&(e(this,1),function(t){t.ks[n]*=-1,t.ys[n]=t.ks[n]*t.xs[n]+t.bs[n]}(this))},draw:function(){for(var t=0;t<this.drawFnArr.length;t++){var e=this.drawFnArr[t],n=this.xs[t],o=this.ys[t];"img"==e.type?e.fn(this.ctx,this.imgDomArr,n,o,30,30):"rect"==e.type&&e.fn(this.ctx,n,o)}}},e}()},e});